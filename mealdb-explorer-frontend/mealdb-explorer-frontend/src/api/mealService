import apiClient from './client';

export const mealService = {
  // Search meals by name
  searchMeals: async (name) => {
    if (!name || !name.trim()) {
      return [];
    }
    
    try {
      const response = await apiClient.get('/meals/search', {
        params: { name: name.trim() },
      });
      return response.data || [];
    } catch (error) {
      console.error('Error searching meals:', error);
      throw error;
    }
  },

  // Get meal by ID
  getMealById: async (id) => {
    if (!id) {
      throw new Error('Meal ID is required');
    }
    
    try {
      const response = await apiClient.get(`/meals/${id}`);
      return response.data;
    } catch (error) {
      console.error('Error fetching meal:', error);
      throw error;
    }
  },

  // Get random meal
  getRandomMeal: async () => {
    try {
      const response = await apiClient.get('/meals/random');
      return response.data;
    } catch (error) {
      console.error('Error fetching random meal:', error);
      throw error;
    }
  },

  // Get all categories
  getCategories: async () => {
    try {
      const response = await apiClient.get('/meals/categories');
      return response.data || [];
    } catch (error) {
      console.error('Error fetching categories:', error);
      throw error;
    }
  },

  // Get meals by category
  getMealsByCategory: async (category) => {
    if (!category || !category.trim()) {
      throw new Error('Category is required');
    }
    
    try {
      const response = await apiClient.get(`/meals/category/${encodeURIComponent(category)}`);
      return response.data || [];
    } catch (error) {
      console.error('Error fetching meals by category:', error);
      throw error;
    }
  },

  // Get popular meals (all meals)
  getPopularMeals: async () => {
    try {
      const response = await apiClient.get('/meals/popular');
      return response.data || [];
    } catch (error) {
      console.error('Error fetching popular meals:', error);
      throw error;
    }
  },

  // What can I cook
  whatCanICook: async (ingredients, minMatchPercentage = 30) => {
    if (!ingredients || !Array.isArray(ingredients) || ingredients.length === 0) {
      throw new Error('Ingredients list is required');
    }
    
    // Filter out empty strings
    const validIngredients = ingredients
      .map(ing => ing.trim())
      .filter(ing => ing.length > 0);
    
    if (validIngredients.length === 0) {
      throw new Error('At least one valid ingredient is required');
    }
    
    try {
      const response = await apiClient.post('/meals/what-can-i-cook', {
        ingredients: validIngredients,
        minMatchPercentage,
      });
      return response.data || [];
    } catch (error) {
      console.error('Error finding matching meals:', error);
      throw error;
    }
  },

  // Health check
  checkHealth: async () => {
    try {
      const response = await apiClient.get('/health');
      return response.data;
    } catch (error) {
      console.error('Health check failed:', error);
      throw error;
    }
  },
};

export default mealService;